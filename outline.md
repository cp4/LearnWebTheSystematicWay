# 一 站在远处

现在，我，一个有嵌入式开发经验的程序员，面对着新鲜的领域，有基础知识托底和点点滴滴的接触经验，对Web 世界进行一次梳理。

## 1.1 Web 世界的机制

### 客户端/服务器模式
Web 运行在客户端/服务器模式下，以我的了解，客户端是信息获取者，蕴含着主动的行为；服务器是信息提供者，蕴含着被动的行为。由主动者向被动者发起获取信息的请求，被动者响应请求，发送信息给请求者。这是 Web 世界运行的基本规则。

> 系统思维 1.1.1: 是否存在服务器向客户端主动发起的信息请求？  
分析：在二者链接已经建立的情况下，服务器为了更新页面是否有可能直接向客户端推送更新的信息？以我的网页经验来看，页面收到通知、提醒等情况是有的，还有在线音乐、电影等情况，媒体不断加载的过程也是被推送信息的过程，因为流媒体通常会使用 UDP 协议，也就是无连接的协议，因此这其实是一个推送过程。与消息的区别是，消息应该是 TCP 的，也就是说由服务器发起链接请求，链接建立后，推送信息。  
但是这还不严谨，因为受到消息推送还有另一种情况，即客户端“偷偷地”以用户不可见的方式小周期性地向服务器发送问询，一旦服务器端有新的信息，就在某一次受到问询后把新的信息推送给客户端。这种方式应该一定会被使用，因为，比方说我们的手机受到的各种 app 的推送消息，无法想象我们的手机会和服务器一直保持连接，因此一定是 app 内置了主动向服务器发起的问询的机制。但是对于登陆某个网站后，收到了新消息提醒，这是主动问询还是被动接收的信息，我目前不得而知。  
*存疑处*

进一步的，客户端与服务器之间的连接是怎样承载信息的呢？网络协议在传输层上有 TCP 和 UDP 两种，前者是可靠的连接，后者是不可靠的连接。网页、电子邮件、下载文件等都是使用可靠的传输协议 TCP，流媒体的不需要精确信息且时间敏感的内容则会使用 UDP，由于 UDP 比较简单，且使用场景相对少很多，基本上可以先把目光锁定在 TCP 上。TCP 协议有长连接和短连接两种，前者在连接发起端和接收端之间一直保持连接，像是拨通电话后，无论说话与否，电话都不挂断，什么时候想说可以随时接着说；后者更像是说完就挂断电话的交流模式。

> 系统思维 1.1.2：Web 世界里，客户端和服务器之间使用长连接还是短连接呢？
分析：Web 获取信息的方式是以获得页面为基础的，页面中又嵌套者许许多多的链接，有些要和页面一起展示，有些在用户点击后展示。这些链接如果指向相同的服务器，那么建立一个长连接，随需获取服务器端信息，当然比较方便，但是这是不能保证的，页面中的各种链接很可能指向各种不同的服务器，如果每个链接都始终保持，很多又无必要，比如某个图片的链接，获得图片后就完全不需要再用了，因为，保持长连接无疑占用了大量的资源；对于服务器也是一样，服务器要响应大量的用户，对每个请求保持长连接，是极大的计算和带宽负担。因此，客户与服务器的基本连接方式以短连接，用过即撤为宜。  
但是，如果我在系统思维 1.1.1 的分析中：服务器需要向客户端推送消息的猜测是正确的，则在某些情况下，一定需要长连接，使服务器能够向客户端推送信息。
这样说来，以短连接为基础，辅以长连接应该比较合理。但是客户端向服务器发起请求时，怎么知道应该建立长连接还是短连接呢？  
这就自然引发了另一个问题。Web 服务当然不会直接建立在传输层协议上，而是以某应用层协议为直接基础。这个协议众所周知：HTTP 协议。HTTP 的详细解读又是一本厚书，我所知不多。在当前这个话题上，需要存疑的问题是：HTTP 协议中是否有定义哪些请求使用长连接，哪些请求使用短连接？


### HTTP 协议
HTTP 协议可能很复杂，但是，在此我们运用系统化思维分析一下这个协议应该有些什么主要内容，对今后的学习应该很有裨益。
> 系统思维 1.1.3：HTTP 协议主要做什么？  
分析：HTTP 协议是为网页传输之用的，网页是纯文本文件，因此 HTTP 基本上是一个传输文件的协议。当然网页中还包含图片等，但也一同视为文件即可。网页固然已有巨大的发展，HTTP 当然也会不断演进，但是其初衷也就是其主干，就是传输文件。那么和 FTP 等专用于文件传输的文件相比，HTTP 有什么独特之处呢？  
可能最主要的差别，就是网页中有嵌套的链接，这些链接的资源，比如图片，要以对用户透明的方式一同被显示出来，也就是说，对网页要有一定的解读，对于各类资源要有一定的组织。因此比 FTP 应该会复杂一些，另外 FTP 是双通道的连接，其中一个连接用于控制，HTTP 的资源请求则自动化很多，不太需要人为干预。  
对这个问题我感觉到思考乏力，一方面因为信息太少，另一方面因为对于指定网络协议缺乏经验，思维触及面太窄。需要学习。

